# ë¦¬ì•¡í‹°ë¸Œ í”„ë¡œê·¸ë˜ë°

- ë¦¬ì•¡í‹°ë¸Œ í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” ë‹¤ì–‘í•œ ì‹œìŠ¤í…œê³¼ ì†ŒìŠ¤ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ë°ì´í„° í•­ëª© ìŠ¤íŠ¸ë¦¼ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  í•©ì³ì„œ ë¬¸ì œ í•´ê²°
  - ë°œìƒí•œ ë°ì´í„° í•­ëª©ì„ ë°”ë¡œ ì²˜ë¦¬í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë†’ì€ ì‘ë‹µì„± ì œê³µ
  - ì „ì²´ì˜ ë¦¬ì•¡í‹°ë¸Œ ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ëŠ” ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¡°ì ˆí•˜ëŠ” ë°ë„ ë¦¬ì•¡í‹°ë¸Œ ê¸°ë²• ì‚¬ìš© ê°€ëŠ¥
  - ê³ ì¥, ì •ì „ ìƒíƒœì— ëŒ€ì²˜ â• ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœì—ì„œ ë©”ì‹œì§€ êµí™˜, ì „ë‹¬
  - ë¬´ê±°ìš´ ì‘ì—…ì„ í•˜ê³  ìˆëŠ” ìƒí™©ì—ì„œë„ ê°€ìš©ì„± ì œê³µ

# ë¦¬ì•¡í‹°ë¸Œ ë§¤ë‹ˆíŒ¨ìŠ¤í† 

- ë¦¬ì•¡í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‹œìŠ¤í…œ ê°œë°œì˜ í•µì‹¬ ì›ì¹™

### ë°˜ì‘ì„±(responsive)

- ì¼ì •í•˜ê³  ì˜ˆìƒí•  ìˆ˜ ìˆëŠ” ë°˜ì‘ ì‹œê°„ ì œê³µ(ì ì • ì‹œê°„ ì•ˆì— ë°˜ì‘)
- ì‚¬ìš©ìì˜ í™•ì‹ ì´ ì¦ê°€í•˜ë©´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ëŠ” í™•ì¸ ì œê³µ

### íšŒë³µì„±(resilient)

- ì¥ì• ê°€ ë°œìƒí•´ë„ ì‹œìŠ¤í…œì€ ë°˜ì‘
- ì»´í¬ë„ŒíŠ¸ ì‹¤í–‰ ë³µì œ, ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì˜ ì‹œê°„(ë°œì†¡ìì™€ ìˆ˜ì‹ ìê°€ ë…ë¦½ì ì¸ ìƒëª… ì£¼ê¸°ë¥¼ ê°€ì§)ê³¼ ê³µê°„(ë°œì†¡ìì™€ ìˆ˜ì‹ ìê°€ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‹¤í–‰) ë¶„ë¦¬, ê° ì»´í¬ë„ŒíŠ¸ê°€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì— ì‘ì—… ìœ„ì„ ...
- ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°œìƒí•œ ì¥ì• ë¥¼ ê³ ë¦½ â¡ï¸ ë¬¸ì œê°€ ì£¼ë³€ì˜ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ë¡œ ì „íŒŒë˜ë©´ì„œ ì „ì²´ ì‹œìŠ¤í…œ ì¥ì• ë¡œ ì´ì–´ì§€ëŠ” ê²ƒì„ ë§‰ìŒ

### íƒ„ë ¥ì„±(elastic)

- ì‘ì—… ë¶€í•˜ê°€ ë°œìƒí•˜ë©´ ìë™ìœ¼ë¡œ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ì— í• ë‹¹ëœ ìì› ìˆ˜ë¥¼ ëŠ˜ë¦¼
- ë‹¤ì–‘í•œ ì‘ì—… ë¶€í•˜ì—ë„ ì‹œìŠ¤í…œ ë°˜ì‘ì„±ì´ ìœ ì§€

### ë©”ì‹œì§€ ì£¼ë„(Message-driven)

- ë¹„ë™ê¸° ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•´ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì„œë¡œ í†µì‹ 
- ë©”ì‹œì§€ ì£¼ë„ë¥¼ í†µí•´ íšŒë³µì„±(ì¥ì•  ë©”ì‹œì§€ë¡œ ì²˜ë¦¬) â• íƒ„ë ¥ì„±(ì£¼ê³  ë°›ì€ ë©”ì‹œì§€ ìˆ˜ ê°ì‹œ, ë©”ì‹œì§€ì˜ ì–‘ì— ë”°ë¼ ì ì ˆí•˜ê²Œ ë¦¬ì†ŒìŠ¤ í• ë‹¹)ì„ ì–»ì„ ìˆ˜ ìˆìŒ
- ë¹„ë™ê¸° ë©”ì‹œì§€ ì „ë‹¬ì— ì˜ì¡´í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ì•½í•œ ê²°í•©, ê³ ë¦½, ìœ„ì¹˜ íˆ¬ëª…ì„±ì´ ìœ ì§€

## ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì¤€ì˜ ë¦¬ì•¡í‹°ë¸Œ - ë¦¬ì•¡í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜

- ì£¼ìš” ê¸°ëŠ¥ : ë¹„ë™ê¸°ë¡œ ì‘ì—… ìˆ˜í–‰
- ë¹„êµì  ì§§ì€ ì‹œê°„ ë™ì•ˆë§Œ ìœ ì§€ë˜ëŠ” ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì— ê¸°ë°˜í•œ ì—°ì‚° ìˆ˜í–‰
- `ì´ë²¤íŠ¸ ì£¼ë„` : ì´ë²¤íŠ¸ë¥¼ ê´€ì°°í•˜ë„ë¡ ë“±ë¡ëœ ì»´í¬ë„ŒíŠ¸ê°€ ìˆ˜ì‹ 
- ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ì„ ë¸”ë¡í•˜ì§€ ì•Šê³  ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ìµœì‹  ë©€í‹°ì½”ì–´ CPUì˜ ì‚¬ìš©ë¥ ì„ ê·¹ëŒ€í™”
- ìŠ¤ë ˆë“œ(ìƒëŒ€ì ìœ¼ë¡œ ë¹„ì‹¸ê³  í¬ê·€í•œ ìì›)ë¥¼ í“¨ì²˜, ì•¡í„°, ì¼ë ¨ì˜ ì½œë°±ì„ ë°œìƒì‹œí‚¤ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ë“±ê³¼ ê³µìœ í•˜ê³  ì²˜ë¦¬í•  ì´ë²¤íŠ¸ë¥¼ ë³€í™˜í•˜ê³  ê´€ë¦¬
- ë™ê¸°, ë¹„ë™ê¸° ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¶”ìƒ ìˆ˜ì¤€ì„ ë†’ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë™ê¸° ë¸”ë¡, ê²½ìŸ ì¡°ê±´ ë°ë“œë½ ê°™ì€ ì € ìˆ˜ì¤€ì˜ ë©€í‹°ìŠ¤ë ˆë“œ ë¬¸ì œë¥¼ ì§ì ‘ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ì–´ì§ â¡ï¸ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì„ êµ¬í˜„í•˜ëŠ” ë° ë” ì§‘ì¤‘
- CPU ê´€ë ¨ ì‘ì—…ê³¼ I/O ê´€ë ¨ ì‘ì—…ì„ ë¶„ë¦¬í•˜ë©´ ì •ë°€í•˜ê²Œ í’€ì˜ í¬ê¸° ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆê³  ë‘ ì¢…ë¥˜ì˜ ì‘ì—…ì˜ ì„±ëŠ¥ì„ ê´€ì°°í•  ìˆ˜ ìˆìŒ
- ë¦¬ì•¡í‹°ë¸Œ ì‹œìŠ¤í…œì„ ë§Œë“œë ¤ë©´ í›Œë¥­í•˜ê²Œ ì„¤ê³„ëœ ë¦¬ì•¡í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì§‘í•©ì´ ì„œë¡œ ì˜ ì¡°í™”ë¥¼ ì´ë£¨ê²Œ í•´ì•¼ í•¨
- `ì‹œê°„`ì— ê¸°ë°˜í•œ ë¹„ë™ê¸°, ë™ì‹œì , ë¹„ê²°í•©

## ì‹œìŠ¤í…œ ìˆ˜ì¤€ì˜ ë¦¬ì•¡í‹°ë¸Œ - ë¦¬ì•¡í‹°ë¸Œ ì‹œìŠ¤í…œ

- ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¡°ë¦½í•˜ê³  ìƒí˜¸ì†Œí†µì„ ì¡°ì ˆ
- `ë©”ì‹œì§€ ì£¼ë„` : ì •ì˜ëœ ëª©ì ì§€ í•˜ë‚˜
- ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•œ ê°œì˜ ì¼ê´€ì ì¸, íšŒë³µí•  ìˆ˜ ìˆëŠ” í”Œë«í¼ì„ êµ¬ì„±í•  ìˆ˜ ìˆê²Œ í•¨
- ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤‘ í•˜ë‚˜ê°€ ì‹¤íŒ¨í•´ë„ ì „ì²´ ì‹œìŠ¤í…œì€ ê³„ì† ìš´ì˜ë  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…ì²˜
- ìˆ˜ì‹ ìì™€ ë°œì‹ ìê°€ ê°ê° ìˆ˜ì‹  ë©”ì‹œì§€, ë°œì‹  ë©”ì‹œì§€ì™€ ê²°í•©í•˜ì§€ ì•Šë„ë¡ ë©”ì‹œì§€ë¥¼ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•´ì•¼ í•¨
- ë¬¸ì œë¥¼ ê²©ë¦¬í•˜ì—¬ ì—ëŸ¬ ì „íŒŒë¥¼ ë°©ì§€í•˜ê³  ë©”ì‹œì§€ë¡œ ë°”ê¾¸ì–´ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ë¡œ ë³´ë‚´ëŠ” ë“± ê°ë…ì ì—­í• ì„ ìˆ˜í–‰
  - ì»´í¬ë„ŒíŠ¸ ìì²´ë¡œ ë¬¸ì œê°€ í•œì •, ì™¸ë¶€ë¡œëŠ” ì•ˆì „ì„± ë³´ì¥
- `ìœ„ì¹˜ íˆ¬ëª…ì„±`ì„ í†µí•œ ê³µê°„ì  ë¹„ê²°í•©
  - ë¦¬ì•¡í‹°ë¸Œ ì‹œìŠ¤í…œì˜ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ìˆ˜ì‹ ìì˜ ìœ„ì¹˜ì— ìƒê´€ì—†ì´ ë‹¤ë¥¸ ëª¨ë“  ì„œë¹„ìŠ¤ì™€ í†µì‹ í•  ìˆ˜ ìˆìŒ
  - ì‹œìŠ¤í…œ ë³µì œ ê°€ëŠ¥
  - í˜„ì¬ ì‘ì—… ë¶€í•˜ì— ë”°ë¼ ì• í”Œë¦¬ì¼€ì´ì…˜ í™•ì¥ ê°€ëŠ¥

# ë¦¬ì•¡í‹°ë¸Œ ìŠ¤íŠ¸ë¦¼ê³¼ í”Œë¡œ API

- ë¦¬ì•¡í‹°ë¸Œ ìŠ¤íŠ¸ë¦¼ : ì ì¬ì ìœ¼ë¡œ ë¬´í•œì˜ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ìˆœì„œëŒ€ë¡œ, ë¸”ë¡í•˜ì§€ ì•ŠëŠ” ì—­ì••ë ¥ì„ ì „ì œí•´ ì²˜ë¦¬í•˜ëŠ” í‘œì¤€ ê¸°ìˆ 
  - `ì—­ì••ë ¥` : ë°œí–‰-êµ¬ë… í”„ë¡œí† ì½œì—ì„œ ë°œí–‰ìê°€ ì´ë²¤íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ì†ë„ë³´ë‹¤ ëŠë¦° ì†ë„ë¡œ ì†Œë¹„í•˜ë©´ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë³´ì¥í•˜ëŠ” ì¥ì¹˜
- ë¶€í•˜ê°€ ë°œìƒí•œ ì»´í¬ë„ŒíŠ¸ëŠ” ì´ë²¤íŠ¸ ë°œí–‰ ì†ë„ë¥¼ ëŠ¦ì¶”ë¼ê³  ì•Œë¦¬ê±°ë‚˜, ì–¼ë§ˆë‚˜ ë§ì€ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œë¦¬ê±°ë‚˜, ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ë°›ê¸° ì „ì— ê¸°ì¡´ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë° ì–¼ë§ˆë‚˜ ì‹œê°„ì´ ê±¸ë¦¬ëŠ”ì§€ë¥¼ ì—…ìŠ¤íŠ¸ë¦¼ ë°œí–‰ìì—ê²Œ ì•Œë¦´ ìˆ˜ ìˆì–´ì•¼ í•¨
- ì—­ì••ë ¥ì´ë‚˜ ì œì–´ íë¦„ ê¸°ë²•ì„ í†µí•´ ë°ì´í„° ìˆ˜ì‹ ìê°€ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡í•˜ì§€ ì•Šìœ¼ë©´ì„œë„ ì²˜ë¦¬í•  ìˆ˜ ì—†ì„ë§Œí¼ ë§ì€ ë°ì´í„°ë¥¼ ë°›ëŠ” ì¼ì„ ë°©ì§€í•˜ëŠ” í”„ë¡œí† ì½œì„ ì œê³µ

## Flow í´ë˜ìŠ¤ ì†Œê°œ

- uninstantiable ì¸ìŠ¤í„´ìŠ¤í™” í•  ìˆ˜ ì—†ìŒ
- ì¤‘ì²©ëœ ì¸í„°í˜ì´ìŠ¤ ë„¤ ê°œë¥¼ í¬í•¨
  - Publisher : ì´ë²¤íŠ¸ ë°œí–‰
  - Subscriber : ì´ë²¤íŠ¸ ì†Œë¹„, Subscriberì˜ ìš”êµ¬ ì‚¬í•­ì— ë”°ë¼ ì—­ì••ë ¥ ê¸°ë²•ì— ì˜í•´ ì´ë²¤íŠ¸ ì œê³µ ì†ë„ ì œí•œ
  - Subscription : Publisherì™€ Subscriber ì‚¬ì´ì˜ ì œì–´ íë¦¼, ì—­ì••ë ¥ ê´€ë¦¬
  - Processor

```java
public final class Flow {

    private Flow() {} // uninstantiable

    @FunctionalInterface
    public static interface Publisher<T> {
        public void subscribe(Subscriber<? super T> subscriber);
    }

    public static interface Subscriber<T> {
        // ì½œë°± ë©”ì„œë“œ
        // onSubscribe onNext* (onError | onComplete)? ìˆœì„œë¡œ í˜¸ì¶œë˜ì–´ì•¼ í•¨
        // onSubscibe í•­ìƒ ë¨¼ì €
        // onNext ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë  ìˆ˜ ìˆìŒ
        public void onSubscribe(Subscription subscription);
        public void onNext(T item);
        public void onError(Throwable throwable); // Publisherì— ì¥ì• ê°€ ë°œìƒ í–ˆì„ ë•Œ
        public void onComplete(); // ë” ì´ìƒì˜ ë°ì´í„°ê°€ ì—†ê³  ì¢…ë£Œë¨
    }

    public static interface Subscription {
        public void request(long n); // Publisherì—ê²Œ ì£¼ì–´ì§„ ê°œìˆ˜ì˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŒì„ ì•Œë¦¼
        public void cancel(); // subscription ì·¨ì†Œ(êµ¬ë… ì·¨ì†Œ)
    }

    // Subscriber, Publisher ìƒì†ë§Œ ë°›ìŒ
    public static interface Processor<T,R> extends Subscriber<T>, Publisher<R> {
    }

    static final int DEFAULT_BUFFER_SIZE = 256;
    public static int defaultBufferSize() {
        return DEFAULT_BUFFER_SIZE;
    }
}
```

- Subscriberê°€ Publisherì— subscribe â¡ï¸ onSubscribeë¥¼ í˜¸ì¶œí•´ Subscription ê°ì²´ ì „ë‹¬
- ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ ëª¨ë“  ë©”ì„œë“œê°€ voidë¥¼ ë°˜í™˜
  - ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•¨

### Flow ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ê·œì¹™

- PublisherëŠ” Subscriptionbì˜ request ë©”ì„œë“œì— ì •ì˜ëœ ê°œìˆ˜ ì´í•˜ì˜ ìš”ì†Œë§Œ Subscriberì— ì „ë‹¬
  - PublisherëŠ” ì§€ì •ëœ ê°œìˆ˜ë³´ë‹¤ ì ì€ ìˆ˜ì˜ ìš”ì†Œë¥¼ onNextë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŒ
  - ë™ì‘ì´ ì„±ê³µì ìœ¼ë¡œ ëë‚˜ë©´ onComplete í˜¸ì¶œ
  - ë¬¸ì œê°€ ë°œìƒí•˜ë©´ onError í˜¸ì¶œí•´ Subscription ì¢…ë£Œ
- SubscriberëŠ” ìš”ì†Œë¥¼ ë°›ì•„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒì„ Publisherì— ì•Œë ¤ì•¼ í•¨(Subscriber â¡ï¸ Publisher ì—­ì••ë ¥ í–‰ì‚¬)
  - onCompleteë‚˜ onError ì‹ í˜¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ìƒí™©ì—ì„œ Publisherë‚˜ Subscriptionì˜ ì–´ë–¤ ë©”ì„œë“œë„ í˜¸ì¶œí•  ìˆ˜ ì—†ê³  Subscriptionì´ ì·¨ì†Œë˜ì—ˆë‹¤ê³  ê°€ì •í•´ì•¼ í•¨
  - Subscription.request() ë©”ì„œë“œ í˜¸ì¶œ ì—†ì´ë„ ì–¸ì œë“  ì¢…ë£Œ ì‹œê·¸ë„ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì–´ì•¼ í•¨
  - Subscription.cancel() í˜¸ì¶œ ì´í›„ì—ë„ í•œ ê°œ ì´ìƒì˜ onNextë¥¼ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì–´ ìˆì–´ì•¼ í•¨
- Publisherì™€ SubscriberëŠ” ì •í™•í•˜ê²Œ Subscriptionì„ ê³µìœ í•˜ë©° ê°ê°ì´ ê³ ìœ í•œ ì—­í• ì„ ìˆ˜í–‰
  - SubscriberëŠ” onSubscribe, onNext ë©”ì„œë“œì—ì„œ Subscription.request()ë¥¼ ë™ê¸°ì ìœ¼ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆì–´ì•¼ í•¨
  - Subscription.cancel() ë©”ì„œë“œëŠ” ëª‡ ë²ˆì„ í˜¸ì¶œí•´ë„ í•œ ë²ˆ í˜¸ì¶œí•œ ê²ƒê³¼ ê°™ì€ íš¨ê³¼ë¥¼ ê°€ì ¸ì•¼ í•¨

<img src="img/13.png" />

## ë¦¬ì•¡í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë§Œë“¤ê¸°

- java.util.concurrency.Flow ëª…ì„¸ : ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¤€ìˆ˜í•´ì•¼ í•  ê·œì¹™ê³¼ ë‹¤ì–‘í•œ ë¦¬ì•¡í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ ê°œë°œëœ ë¦¬ì•¡í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì„œë¡œ í˜‘ë™í•˜ê³  ì†Œí†µí•  ìˆ˜ ìˆëŠ” ê³µìš©ì–´ë¥¼ ì œì‹œ

```java
public class TempInfo {
    public static final Random random = new Random();

    private final String town;
    private final int temp;

    private TempInfo(String town, int temp) {
        this.town = town;
        this.temp = temp;
    }

    public static TempInfo fetch(String town) {
        if (random.nextInt(10) == 0) { // 10ë¶„ì˜ 1 í™•ë¥ ë¡œ ì˜¨ë„ ê°€ì ¸ì˜¤ê¸° ì‘ì—… ì‹¤íŒ¨
            throw new RuntimeException("Error!");
        }
        return new TempInfo(town, random.nextInt(100)); // 0ì—ì„œ 99 ì‚¬ì´ ì„ì˜ì˜ í™”ì”¨ ì˜¨ë„ ë°˜í™˜
    }

    @Override
    public String toString() {
        return town + " : " + temp;
    }
}
```

```java
public class TempSubscription implements Subscription {
    private final Subscriber<? super TempInfo> subscriber;
    private final String town;

    public TempSubscription(Subscriber<? super  TempInfo> subscriber, String town) {
        this.subscriber = subscriber;
        this.town = town;
    }

    @Override
    public void request(long n) {
        for (long i = 0L; i < n; i++) {
            try {
                subscriber.onNext(TempInfo.fetch(town));
            } catch (Exception e) {
                subscriber.onError(e);
                break;
            }
        }
    }

    @Override
    public void cancel() {
        subscriber.onComplete(); // êµ¬ë… ì·¨ì†Œë˜ë©´ onComplete ì „ë‹¬
    }
}
```

```java
public class TempSubscriber implements Subscriber<TempInfo> {
    private Subscription subscription;

    @Override
    public void onSubscribe(Subscription subscription) {
        this.subscription = subscription;
        subscription.request(1);
    }

    @Override
    public void onNext(TempInfo tempInfo) {
        System.out.println(tempInfo);
        subscription.request(1);
    }

    @Override
    public void onError(Throwable t) {
        System.err.println(t.getMessage());
    }

    @Override
    public void onComplete() {
        System.out.println("Done!");
    }
}
```

```java
public class Main {
    public static void main(String[] args) {
        getTemperatures("New York").subscribe(new TempSubscriber());
        // Publisherë¥¼ ë§Œë“¤ê³  êµ¬ë…
    }

    private static Publisher<TempInfo> getTemperatures(String town) {
        // êµ¬ë…í•œ Subscriberì—ê²Œ subscriptionì„ ì „ì†¡í•˜ëŠ” Publisher ë°˜í™˜
        return subscriber -> subscriber.onSubscribe(
                new TempSubscription(subscriber, town));
                // í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ Publisherì˜ subscribe ë©”ì„œë“œì™€ ê°™ì€ ì‹œê·¸ë‹ˆì²˜
                // â¡ï¸ ìë°” ì»´íŒŒì¼ëŸ¬ê°€ ìë™ìœ¼ë¡œ Publisherë¡œ ë°”ê¿ˆ
    }
}
```

### TempInfoì—ì„œ ì„ì˜ë¡œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šìœ¼ë©´ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œ ë°œìƒ

```java
// ğŸ“ TempSubscription

// executor ì¶”ê°€
private static final ExecutorService executor = Executors.newSingleThreadExecutor();

@Override
public void request(long n) {
    executor.submit(() -> { // ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë‹¤ìŒ ìš”ì†Œë¥¼ êµ¬ë…ìì—ê²Œ ë³´ëƒ„
        for (long i = 0L; i < n; i++) {
            try {
                subscriber.onNext(TempInfo.fetch(town));
            } catch (Exception e) {
                subscriber.onError(e);
                break;
            }
        }
    });
}
```

## Processorë¡œ ë°ì´í„° ë³€í™˜

- Processorì˜ ëª©ì  : Publisherë¥¼ êµ¬ë…í•œ ë‹¤ìŒ ìˆ˜ì‹ í•œ ë°ì´í„°ë¥¼ ê°€ê³µí•´ ë‹¤ì‹œ ì œê³µ

```java
public class TempProcessor implements Processor<TempInfo, TempInfo> {
    private Subscriber<? super  TempInfo> subscriber;

    // ì—…ìŠ¤íŠ¸ë¦¼ Subscriberë¥¼ Processorë¡œ ë“±ë¡
    @Override
    public void subscribe(Subscriber<? super TempInfo> subscriber) {
        this.subscriber = subscriber;
    }

    @Override
    public void onNext(TempInfo temp) {
        subscriber.onNext(new TempInfo(temp.getTown(),
                (temp.getTemp() - 32) * 5 / 9)); // ì„­ì”¨ë¡œ ë³€í™˜í•œ ë‹¤ìŒ TempInfo ë‹¤ì‹œ ì „ì†¡
    }

    // ì—…ìŠ¤íŠ¸ë¦¼ êµ¬ë…ìì— ì‹ í˜¸ ì „ë‹¬
    @Override
    public void onSubscribe(Subscription subscription) {
        subscriber.onSubscribe(subscription);
    }

    @Override
    public void onError(Throwable throwable) {
        subscriber.onError(throwable);
    }

    @Override
    public void onComplete() {
        subscriber.onComplete();
    }
}
```

```java
private static Publisher<TempInfo> getCelsiusTemperatures(String town) {
    return subscriber -> {
        TempProcessor processor = new TempProcessor();
        processor.subscribe(subscriber);
        processor.onSubscribe(new TempSubscription(processor, town));
    };
}
```

```java
public static void main(String[] args) {
    getCelsiusTemperatures("New York")
            .subscribe(new TempSubscriber());
}
```

## ìë°”ëŠ” ì™œ í”Œë¡œ API êµ¬í˜„ì„ ì œê³µí•˜ì§€ ì•ŠëŠ”ê°€?

- APIë¥¼ ë§Œë“¤ ë‹¹ì‹œ Akka, RxJava ë“± ë‹¤ì–‘í•œ ë¦¬ì•¡í‹°ë¸Œ ìŠ¤íŠ¸ë¦¼ì˜ ìë°” ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì´ë¯¸ ì¡´ì¬í–ˆê¸° ë•Œë¬¸
- java.util.concurrent.Flow ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ëŸ° ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¦¬ì•¡í‹°ë¸Œ ê°œë…ì„ êµ¬í˜„í•˜ë„ë¡ ì§„í™”
- â¡ï¸ ë‹¤ì–‘í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì‰½ê²Œ í˜‘ë ¥í•  ìˆ˜ ìˆê²Œ ë¨

# ë¦¬ì•¡í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ RxJava ì‚¬ìš©í•˜ê¸°

- ì²œ ê°œ ì´í•˜ì˜ ìš”ì†Œë¥¼ ê°€ì§„ ìŠ¤íŠ¸ë¦¼ì´ë‚˜ ë§ˆìš°ìŠ¤ ì›€ì§ì„, í„°ì¹˜ ì´ë²¤íŠ¸ ë“± GUI ì´ë²¤íŠ¸, ìì£¼ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì¢…ë¥˜ì˜ ì´ë²¤íŠ¸ì— ì—­ì••ë ¥ ì ìš©í•˜ì§€ ë§ ê²ƒì„ ê¶Œì¥

## Observable ë§Œë“¤ê³  ì‚¬ìš©í•˜ê¸°

- ì—­ì••ë ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë²„ì „ : request ë©”ì„œë“œ ì—†ìŒ
- ë‹¨ìˆœí•œ í”„ë¡œê·¸ë¨, ë§ˆìš°ìŠ¤ ì›€ì§ì„ ê°™ì€ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì´ë²¤íŠ¸ì— ë” ì í•©
- ì—­ì••ë ¥ ì§€ì› ë²„ì „ : io.reactivex.Flowable

### `just` íŒ©í† ë¦¬ ë©”ì„œë“œ

- í•œ ê°œ ì´ìƒì˜ ìš”ì†Œë¥¼ ì´ìš©í•´ ì´ë¥¼ ë°©ì¶œí•˜ëŠ” Observableë¡œ ë³€í™˜

```java
Observable<String> strings = Observable.just("first", "second");
// Observableì˜ êµ¬ë…ìëŠ” onNext("first"), onNext("second"), onComplete() ìˆœì„œë¡œ ë©”ì„¸ì§€ ë°›ìŒ
```

### `interval` íŒ©í† ë¦¬ ë©”ì„œë“œ

- ì‚¬ìš©ìì™€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•˜ë©´ì„œ ì§€ì •ëœ ì†ë„ë¡œ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•˜ëŠ” ìƒí™©

```java
Observable<Long> onePerSec = Observable.interval(1, TimeUnit.SECONDS);
// 0ì—ì„œ ì‹œì‘í•´ 1ì´ˆ ê°„ê²©ìœ¼ë¡œ long í˜•ì‹ì˜ ê°’ì„ ë¬´í•œìœ¼ë¡œ ì¦ê°€ì‹œí‚¤ë©° ê°’ ë°©ì¶œ
```

```java
public interface Observer<@NonNull T> {

    void onSubscribe(@NonNull Disposable d);
    void onNext(@NonNull T t);
    void onError(@NonNull Throwable e);
    void onComplete();
}
```

- ìë°” ë„¤ì´í‹°ë¸Œ í”Œë¡œ APIë³´ë‹¤ ìœ ì—°(ì˜¤ë²„ë¡œë“œëœ ë§ì€ ê¸°ëŠ¥ ì œê³µ)
  - onNext ë©”ì„œë“œì˜ ì‹œê·¸ë‹ˆì²˜ì— í•´ë‹¹í•˜ëŠ” ëŒë‹¤ í‘œí˜„ì‹ì„ ì „ë‹¬í•´ Observableì„ êµ¬ë…í•  ìˆ˜ ìˆë‹¤

```java
onePerSec.subscribe(i -> System.out.println(TempInfo.fetch("New York")));
// Observable ì´ˆë‹¹ í•œ ê°œì˜ ì´ë²¤íŠ¸ ë°©ì¶œí•˜ë©° ë©”ì„¸ì§€ ìˆ˜ì‹ 
// â¡ï¸ Subscriberê°€ ë‰´ìš•ì˜ ì˜¨ë„ ì¶”ì¶œí•´ ì¶œë ¥
// RxJavadì˜ ì—°ì‚° ìŠ¤ë ˆë“œ í’€(ë°ëª¬ ìŠ¤ë ˆë“œ)ì—ì„œ ì‹¤í–‰
```

- `blockingSubscribe` : í˜„ì¬ ìŠ¤ë ˆë“œì—ì„œ ì½œë°± í˜¸ì¶œ

```java
onePerSec.blockingSubscribe(
        i -> System.out.println(TempInfo.fetch("New York"))
);
```

### ì‚¬ìš©ìì—ê²Œ íŒ©í† ë¦¬ ë©”ì„œë“œ ì œê³µ â¡ï¸ ë§¤ ì´ˆë§ˆë‹¤ ì˜¨ë„ ë°©ì¶œí•˜ëŠ” Observable ë°˜í™˜

```java
public static Observable<TempInfo> getTemperature(String town) {
    return Observable.create(emitter -> {
        Observable.interval(1, TimeUnit.SECONDS)
                .subscribe(i -> {
                  // emitter = ObservableEmitter
                    if (!emitter.isDisposed()) { // ì†Œë¹„ëœ ì˜µì €ë²„ê°€ ì•„ì§ íê¸°ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì‘ì—… ìˆ˜í–‰
                        if (i >= 5) { // í¸ì˜ìƒ ìµœëŒ€ ë‹¤ì„¯ ë²ˆ ë°©ì¶œ í›„ ì¢…ë£Œ
                            emitter.onComplete();
                        } else {
                            try {
                                emitter.onNext(TempInfo.fetch(town)); // ì˜¨ë„ Observerë¡œ ë³´ê³ 
                            } catch (Exception e) {
                                emitter.onError(e);
                            }
                        }
                    }
                });
    });
}
```

```java
// onSubscribeê°€ ë¹ ì§„ Observer
public interface Emitter<@NonNull T> {

    void onNext(@NonNull T value);
    void onError(@NonNull Throwable error);
    void onComplete();
}
```

```java
public interface ObservableEmitter<@NonNull T> extends Emitter<T> {

    void setDisposable(@Nullable Disposable d);
    void setCancellable(@Nullable Cancellable c);
    boolean isDisposed(); // ì†Œë¹„ëœ Observerê°€ ì´ë¯¸ íê¸°ë˜ì—ˆëŠ”ì§€ í™•ì¸
    @NonNull
    ObservableEmitter<T> serialize();
    boolean tryOnError(@NonNull Throwable t);
}

```

- Observableì— ê°€ì…ì‹œí‚¬ Observer

```java
public class TempObserver implements Observer<TempInfo> {
    @Override
    public void onComplete() {
        System.out.println("Done!");
    }

    @Override
    public void onError(@NonNull Throwable e) {
        System.out.println("Got problem: " + e.getMessage());
    }

    @Override
    public void onSubscribe(@NonNull Disposable d) {

    }

    @Override
    public void onNext(@NonNull TempInfo tempInfo) {
        System.out.println(tempInfo);
    }
}
```

```java
public static void main(String[] args) {
    Observable<TempInfo> observable = getTemperature("New York");
    observable.blockingSubscribe(new TempObserver());
}

// New York : 22
// New York : 88
// New York : 84
// New York : 99
// New York : 16
// Done!
```

## Observable ë³€í™˜í•˜ê³  í•©ì¹˜ê¸°

- ìŠ¤íŠ¸ë¦¼ì—ì„œ ê´€ã……ë‹˜ ìˆëŠ” ìš”ì†Œë§Œ ê±°ë¦° ë‹¤ë¥¸ ìŠ¤íŠ¸ë¦¼ì„ ë§Œë“¤ê±°ë‚˜
- ë§¤í•‘ í•¨ìˆ˜ë¡œ ìš”ì†Œë¥¼ ë³€í™˜í•˜ê±°ë‚˜
- ë‘ ìŠ¤íŠ¸ë¦¼ì„ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ í•©ì¹˜ëŠ” ë“± ì‘ì—…ì„ í•  ìˆ˜ ìˆìŒ

<img src="img/14.png" />

- `map` : Observableì„ ë°›ì•„ ë³€ê²½í•œ í›„ ë˜ ë‹¤ë¥¸ Observable ë°˜í™˜

```java
public static Observable<TempInfo> getCelsiusTemperature(String town)  {
    return getTemperature(town)
            .map(temp -> new TempInfo(temp.getTown(), (temp.getTemp() - 32) * 5 / 9));
}
```

<img src="img/15.png" />

- `filter`

```java
public static Observable<TempInfo> getNegativeTemperature(String town) {
    return getCelsiusTemperature(town)
            .filter(temp -> temp.getTemp() < 0);
}
```

<img src="img/16.png" />

- `merge` : Observableì˜ Iterableì„ ì¸ìˆ˜ë¡œ ë°›ì•„ í•œ ê°œì˜ Observableì²˜ëŸ¼ ë™ì‘í•˜ë„ë¡ ê²°ê³¼ë¥¼ í•©ì¹¨

```java
public static Observable<TempInfo> getCelsiusTemperature(String... towns) {
    return Observable.merge(Arrays.stream(towns)
            .map(TempObservable::getCelsiusTemperature)
            .toList());
}
```

```java
Observable<TempInfo> observable = getCelsiusTemperature("New York", "Chicago", "San Francisco");
observable.blockingSubscribe(new TempObserver());

// New York : 10
// Chicago : -8
// San Francisco : 24
// Chicago : -6
// New York : 6
// San Francisco : 29
// Chicago : 35
// New York : 27
// San Francisco : -17
// New York : 27
// Chicago : -9
// San Francisco : 29
// San Francisco : -1
// New York : -3
// Chicago : 4
```
